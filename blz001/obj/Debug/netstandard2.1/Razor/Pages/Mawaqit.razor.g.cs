#pragma checksum "D:\Dev\wasm\blz001\Pages\Mawaqit.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "f48bd49e12f01dc0daf411be2753cbcc5cb85627"
// <auto-generated/>
#pragma warning disable 1591
namespace blz001.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "D:\Dev\wasm\blz001\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\Dev\wasm\blz001\_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\Dev\wasm\blz001\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\Dev\wasm\blz001\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\Dev\wasm\blz001\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\Dev\wasm\blz001\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\Dev\wasm\blz001\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\Dev\wasm\blz001\_Imports.razor"
using blz001;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\Dev\wasm\blz001\_Imports.razor"
using blz001.Shared;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/mawaqit")]
    public partial class Mawaqit : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
            __builder.OpenElement(0, "div");
            __builder.AddAttribute(1, "id", "container");
            __builder.AddAttribute(2, "dir", "rtl");
            __builder.AddMarkupContent(3, "\r\n    ");
            __builder.OpenElement(4, "div");
            __builder.AddAttribute(5, "id", "left");
            __builder.AddAttribute(6, "style", "width:" + " " + (
#nullable restore
#line 4 "D:\Dev\wasm\blz001\Pages\Mawaqit.razor"
                                   Position

#line default
#line hidden
#nullable disable
            ) + "%;" + " display:" + " inline-block;" + " *display:" + " inline;" + " zoom:" + " 1;" + " vertical-align:" + " top;" + " font-size:" + " 12px;");
            __builder.CloseElement();
            __builder.AddMarkupContent(7, "\r\n    ");
            __builder.OpenElement(8, "div");
            __builder.AddAttribute(9, "id", "middle");
            __builder.AddAttribute(10, "style", "width: 17%; background: #FFAAFF; display: inline-block; *display: inline; zoom: 1; vertical-align: top; font-size: 12px;");
            __builder.AddMarkupContent(11, "\r\n      ");
            __builder.OpenComponent<blz001.Shared.Card>(12);
            __builder.AddAttribute(13, "Title", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.String>(
#nullable restore
#line 6 "D:\Dev\wasm\blz001\Pages\Mawaqit.razor"
                   DateTime.Now.ToString("HH:mm")

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(14, "Value", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.String>(
#nullable restore
#line 7 "D:\Dev\wasm\blz001\Pages\Mawaqit.razor"
               Position.ToString()

#line default
#line hidden
#nullable disable
            ));
            __builder.CloseComponent();
            __builder.AddMarkupContent(15, "\r\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(16, "\r\n    ");
            __builder.OpenElement(17, "div");
            __builder.AddAttribute(18, "id", "right");
            __builder.AddAttribute(19, "style", "width:" + " " + (
#nullable restore
#line 9 "D:\Dev\wasm\blz001\Pages\Mawaqit.razor"
                                    81-Position

#line default
#line hidden
#nullable disable
            ) + "%;" + " display:" + " inline-block;" + " *display:" + " inline;" + " zoom:" + " 1;" + " vertical-align:" + " top;" + " font-size:" + " 12px;");
            __builder.CloseElement();
            __builder.AddMarkupContent(20, "\r\n");
            __builder.CloseElement();
            __builder.AddMarkupContent(21, "\r\n\r\n\r\n");
            __builder.OpenElement(22, "div");
            __builder.AddAttribute(23, "class", "row");
            __builder.AddAttribute(24, "dir", "rtl");
            __builder.AddMarkupContent(25, "\r\n  <div class=\"col-sm-1\" style=\"padding: 0px; border: transparent; border-width: 3px;\"></div>\r\n");
#nullable restore
#line 15 "D:\Dev\wasm\blz001\Pages\Mawaqit.razor"
     foreach (var value in Values)
    {

#line default
#line hidden
#nullable disable
            __builder.AddContent(26, "        ");
            __builder.OpenElement(27, "div");
            __builder.AddAttribute(28, "class", "col-sm-2");
            __builder.AddAttribute(29, "style", "padding:" + " 0px;" + " border:" + " solid;" + "\r\n                border-color:" + " " + (
#nullable restore
#line 18 "D:\Dev\wasm\blz001\Pages\Mawaqit.razor"
                               GetBorderColor(value.IsSelected)

#line default
#line hidden
#nullable disable
            ) + ";" + "\r\n                border-width:" + " 3px;" + " border-top-color:" + " " + (
#nullable restore
#line 19 "D:\Dev\wasm\blz001\Pages\Mawaqit.razor"
                                                      GetBorderColor(value.IsSelected, isTop:true)

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(30, "\r\n            ");
            __builder.OpenComponent<blz001.Shared.Card>(31);
            __builder.AddAttribute(32, "Title", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.String>(
#nullable restore
#line 20 "D:\Dev\wasm\blz001\Pages\Mawaqit.razor"
                         value.Title

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(33, "Value", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.String>(
#nullable restore
#line 21 "D:\Dev\wasm\blz001\Pages\Mawaqit.razor"
                               value.Value

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(34, "TextColor", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.String>(
#nullable restore
#line 22 "D:\Dev\wasm\blz001\Pages\Mawaqit.razor"
                                    value.IsSelected ? SelectedTextColor : TextColor

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(35, "BackgroundColor", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.String>(
#nullable restore
#line 23 "D:\Dev\wasm\blz001\Pages\Mawaqit.razor"
                                          value.IsSelected ? SelectedBackgroundColor : BackgroundColor

#line default
#line hidden
#nullable disable
            ));
            __builder.CloseComponent();
            __builder.AddMarkupContent(36, "\r\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(37, "\r\n");
#nullable restore
#line 25 "D:\Dev\wasm\blz001\Pages\Mawaqit.razor"
    }

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(38, "  <div class=\"col-sm-1\" style=\"padding: 0px; border: transparent; border-width: 3px;\"></div>\r\n");
            __builder.CloseElement();
        }
        #pragma warning restore 1998
#nullable restore
#line 29 "D:\Dev\wasm\blz001\Pages\Mawaqit.razor"
       

  [Parameter]
  public string BackgroundColor { get; set; } = "#1b8046";

  [Parameter]
  public string TextColor { get; set; } = "#FFFFFF";

  [Parameter]
  public string SelectedTextColor { get; set; } = "#FFFFFF";

  [Parameter]
  public string SelectedBackgroundColor { get; set; } = "#275eb0";

  [Parameter]
  public string DateTextColor { get; set; } = "#FFFFFF";

  [Parameter]
  public string DateBackgroundColor { get; set; } = "#943d1b";

  [Parameter]
  public string TimeTextColor { get; set; } = "#FFFFFF";

  [Parameter]
  public string TimeBackgroundColor { get; set; } = "#6b1565";

  IEnumerable<(string Title, string Value, bool IsSelected)> Values {get; set;}

	System.Threading.Timer _timer ; 
  
  int Position { get; set; }
	protected override Task OnInitializedAsync()
	{
		var now = DateTime.Now;
    var times = GetTimes(DateTime.Now);
		Values = times.Take(1).Concat(times.Skip(2))
			.Select(x => (x.arName, x.time.ToString("HH:mm"), false));

		Position = 0;
		_timer = new System.Threading.Timer(OnTimerTick);
		_timer.Change(3000, 30000);

		return base.OnInitializedAsync();
	}

	private void OnTimerTick(object sender)
	{
		var loc = Position;
		loc++;
		Position++; 
		if (Position == 200) Position = 0;

   var timesAndNames = GetTimes(DateTime.Now);
	 var times = timesAndNames.Take(1).Concat(timesAndNames.Skip(2))
			.Select(x => x.time);

    var arranger = new Services.TimeArranger();
    Position = (int)(arranger.GetArrangement(times, DateTime.Now)*100);

		StateHasChanged();
	}

	private IEnumerable<(string enName, string arName, DateTime time)> GetTimes(DateTime dt)
	{
		var st = new Services.SalatTime();
		st.SetCalcMethod(Services.CalculationMethod.Isna);

		double latitude = 45.5977;
		double longitude = -73.5937;
		int timeZone = -4;

		var eventTimes = st.GetTimes(dt.Year, dt.Month, dt.Day, latitude, longitude, timeZone);

		// Time Names
		String[] englishNames = { "Subh", "Sunrise", "Dhuhr", "Asr", "Sunset", "Maghrib", "Isha" };
		// Arabic Names
		String[] arabicNames = { "الصبح", "الشروق", "الظهر", "العصر", "الغروب", "المغرب", "العشاء" };
		// Mixed Names
		String[] mixedNames = { "Subh", "Sunrise", "Dhuhr", "Asr", "Sunset", "Maghrib", "Isha" };

		var result = new List<(string, string, DateTime)>();

		int i = 0;
		foreach (var time in eventTimes)
		{
			if (i == 4)
			{
				i++;
				continue;
			}
			result.Add((mixedNames[i], arabicNames[i], time));
			i++;
		}

		return result;
	}

	public string GetBorderColor(bool isSelected, bool isTop = false)
	{
		var color = isSelected ? SelectedBackgroundColor : BackgroundColor;

		if (isTop && isSelected)
			return color;

		return GetBorderColor(color);
	}

   public string GetBorderColor(string color)
   {
     var (r, g, b) = ToRGB(color);
     return FromRGB(((byte)(r * 2 / 3), (byte)(g * 2 / 3), (byte)(b * 2 / 3)));
   }

   public static (byte r, byte g, byte b) ToRGB(string colorString)
   {
     try
     {
       var val = int.Parse(colorString.Substring(1), System.Globalization.NumberStyles.HexNumber);
       var r = (byte)(val / 0x10000);
       var g = (byte)((val & 0x00FFFF) / 0x100);
       var b = (byte)(val & 0xFF);
       return (r, g, b);
     }
     catch (Exception)
     {
       return (0, 0, 0);
     }
   }

   public static string FromRGB((byte r, byte g, byte b) value)
   {
     return $"#{value.r:X2}{value.g:X2}{value.b:X2}";
   }

#line default
#line hidden
#nullable disable
    }
}
#pragma warning restore 1591
