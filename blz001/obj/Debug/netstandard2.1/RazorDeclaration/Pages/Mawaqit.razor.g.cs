#pragma checksum "D:\Dev\wasm\blz001\Pages\Mawaqit.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "f48bd49e12f01dc0daf411be2753cbcc5cb85627"
// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace blz001.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "D:\Dev\wasm\blz001\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\Dev\wasm\blz001\_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\Dev\wasm\blz001\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\Dev\wasm\blz001\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\Dev\wasm\blz001\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\Dev\wasm\blz001\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\Dev\wasm\blz001\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\Dev\wasm\blz001\_Imports.razor"
using blz001;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\Dev\wasm\blz001\_Imports.razor"
using blz001.Shared;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/mawaqit")]
    public partial class Mawaqit : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 29 "D:\Dev\wasm\blz001\Pages\Mawaqit.razor"
       

  [Parameter]
  public string BackgroundColor { get; set; } = "#1b8046";

  [Parameter]
  public string TextColor { get; set; } = "#FFFFFF";

  [Parameter]
  public string SelectedTextColor { get; set; } = "#FFFFFF";

  [Parameter]
  public string SelectedBackgroundColor { get; set; } = "#275eb0";

  [Parameter]
  public string DateTextColor { get; set; } = "#FFFFFF";

  [Parameter]
  public string DateBackgroundColor { get; set; } = "#943d1b";

  [Parameter]
  public string TimeTextColor { get; set; } = "#FFFFFF";

  [Parameter]
  public string TimeBackgroundColor { get; set; } = "#6b1565";

  IEnumerable<(string Title, string Value, bool IsSelected)> Values {get; set;}

	System.Threading.Timer _timer ; 
  
  int Position { get; set; }
	protected override Task OnInitializedAsync()
	{
		var now = DateTime.Now;
    var times = GetTimes(DateTime.Now);
		Values = times.Take(1).Concat(times.Skip(2))
			.Select(x => (x.arName, x.time.ToString("HH:mm"), false));

		Position = 0;
		_timer = new System.Threading.Timer(OnTimerTick);
		_timer.Change(3000, 30000);

		return base.OnInitializedAsync();
	}

	private void OnTimerTick(object sender)
	{
		var loc = Position;
		loc++;
		Position++; 
		if (Position == 200) Position = 0;

   var timesAndNames = GetTimes(DateTime.Now);
	 var times = timesAndNames.Take(1).Concat(timesAndNames.Skip(2))
			.Select(x => x.time);

    var arranger = new Services.TimeArranger();
    Position = (int)(arranger.GetArrangement(times, DateTime.Now)*100);

		StateHasChanged();
	}

	private IEnumerable<(string enName, string arName, DateTime time)> GetTimes(DateTime dt)
	{
		var st = new Services.SalatTime();
		st.SetCalcMethod(Services.CalculationMethod.Isna);

		double latitude = 45.5977;
		double longitude = -73.5937;
		int timeZone = -4;

		var eventTimes = st.GetTimes(dt.Year, dt.Month, dt.Day, latitude, longitude, timeZone);

		// Time Names
		String[] englishNames = { "Subh", "Sunrise", "Dhuhr", "Asr", "Sunset", "Maghrib", "Isha" };
		// Arabic Names
		String[] arabicNames = { "الصبح", "الشروق", "الظهر", "العصر", "الغروب", "المغرب", "العشاء" };
		// Mixed Names
		String[] mixedNames = { "Subh", "Sunrise", "Dhuhr", "Asr", "Sunset", "Maghrib", "Isha" };

		var result = new List<(string, string, DateTime)>();

		int i = 0;
		foreach (var time in eventTimes)
		{
			if (i == 4)
			{
				i++;
				continue;
			}
			result.Add((mixedNames[i], arabicNames[i], time));
			i++;
		}

		return result;
	}

	public string GetBorderColor(bool isSelected, bool isTop = false)
	{
		var color = isSelected ? SelectedBackgroundColor : BackgroundColor;

		if (isTop && isSelected)
			return color;

		return GetBorderColor(color);
	}

   public string GetBorderColor(string color)
   {
     var (r, g, b) = ToRGB(color);
     return FromRGB(((byte)(r * 2 / 3), (byte)(g * 2 / 3), (byte)(b * 2 / 3)));
   }

   public static (byte r, byte g, byte b) ToRGB(string colorString)
   {
     try
     {
       var val = int.Parse(colorString.Substring(1), System.Globalization.NumberStyles.HexNumber);
       var r = (byte)(val / 0x10000);
       var g = (byte)((val & 0x00FFFF) / 0x100);
       var b = (byte)(val & 0xFF);
       return (r, g, b);
     }
     catch (Exception)
     {
       return (0, 0, 0);
     }
   }

   public static string FromRGB((byte r, byte g, byte b) value)
   {
     return $"#{value.r:X2}{value.g:X2}{value.b:X2}";
   }

#line default
#line hidden
#nullable disable
    }
}
#pragma warning restore 1591
